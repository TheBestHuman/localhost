<h1>Listing Users</h1>

<table>
  <tr>
    <th>Name</th>
	<th>Email</th>
	<th>State</th>
  <th>Role</th>
  <th></th>
  <th></th>
  <th></th>
  </tr>

<% @user.each do |user| %>
    <tr>
      <td><%= link_to "#{user.first_name} #{user.last_name}", user_path(user) %></td>
      <td><%= user.email%></td>
      <td><%= user.state %></td>
      <td><% user.roles.each do |role| %><%= role.name %> <% end %></td>
      <% if current_user.friends.find_by_id(user) %>
        <td>Friend</td>
      <% elsif user == current_user %>
		<td></td>
	  <% else %>
        <td><%= button_to "Add Friendship", friendships_path(:friend_id => user), :method => :post %></td>
      <% end %>
	 <td> <% if permitted_to? :edit, user %>
      		<%= link_to 'Edit User', edit_user_path(user) %>
      	  <% end %></td>
	<td><% if permitted_to? :delete, user %>
      		<%= link_to 'Delete User', user, confirm: 'Are you sure?', method: :delete %>
    	<% end %></td>
    </tr>
<% end %>
</table>
